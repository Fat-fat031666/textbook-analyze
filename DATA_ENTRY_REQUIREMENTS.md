# 数据录入成功条件说明

## 📋 概述

数据录入分为两个步骤，每个步骤有不同的必填要求。根据操作类型（保存草稿 vs 提交审核），条件也有所不同。

---

## 🔹 第一步：教材定位信息

### 必填字段（所有字段都必须填写才能进入第二步）

1. **科目** (`subject`) ⭐
   - 选项：数学、语文、英语、物理、化学、生物、历史、地理
   - 代码：math, chinese, english, physics, chemistry, biology, history, geography

2. **教材版本** (`textbookVersion`) ⭐
   - 选项：人教版、北师大版、苏教版、沪教版、湘教版

3. **学段** (`educationLevel`) ⭐
   - 选项：初中、高中

4. **年级** (`grade`) ⭐
   - 初中：七年级、八年级、九年级
   - 高中：高一年级、高二年级、高三年级

5. **册别** (`book`) ⭐
   - 选项：上册、下册

6. **章** (`chapter`) ⭐
   - 文本输入，例如："第一章 有理数"

7. **节** (`section`) ⭐
   - 文本输入，例如："1.1 正数和负数"

### 验证逻辑
```javascript
// 如果任何字段为空，会显示错误提示并阻止进入第二步
if (!formData.subject || !formData.textbookVersion || !formData.educationLevel 
    || !formData.grade || !formData.book || !formData.chapter || !formData.section) {
  toast.error('请完成所有教材定位信息');
  return;
}
```

---

## 🔹 第二步：知识点信息

### 保存草稿的条件

#### ✅ 必填字段
1. **内容描述** (`content`) ⭐
   - 必须填写知识点内容
   - 最大长度：5000 字符

2. **知识类型** (`knowledgeType`) ⭐
   - 必须从下拉列表中选择
   - 选项：事实性知识、概念性知识、原理规则、技能

#### ⚠️ 可选字段（草稿可以不填）
- **认知层级** (`cognitiveLevel`) - 可选
- **所属主题** (`themes`) - 可选（草稿可以不关联主题）
- **难度等级** (`difficulty`) - 默认值为 1
- **教学提示** (`teachingTip`) - 可选
- **章和节信息** - 如果填写了，会尝试保存，但失败不会阻止保存草稿

#### 验证逻辑
```javascript
// 保存草稿只需要内容和类型
if (!formData.content || !formData.knowledgeType) {
  toast.error('请至少填写知识点内容和类型');
  return;
}
```

---

### 提交审核的条件

#### ✅ 必填字段
1. **内容描述** (`content`) ⭐
   - 必须填写知识点内容
   - 最大长度：5000 字符

2. **知识类型** (`knowledgeType`) ⭐
   - 必须从下拉列表中选择
   - 必须选择有效的知识类型（在后端存在）

3. **所属主题** (`themes`) ⭐
   - **必须至少选择一个主题**
   - 所有选择的主题必须在后端存在（或能够查找/创建）

4. **章和节信息** ⭐
   - 如果填写了章和节，**Section 创建必须成功**
   - 如果 Section 创建失败，会阻止提交并显示错误

#### ⚠️ 可选字段
- **认知层级** (`cognitiveLevel`) - 可选
- **难度等级** (`difficulty`) - 默认值为 1
- **教学提示** (`teachingTip`) - 可选

#### 验证逻辑
```javascript
// 提交审核需要内容、类型和至少一个主题
if (!formData.content || !formData.knowledgeType || formData.themes.length === 0) {
  toast.error('请完成所有必填字段');
  return;
}

// 如果填写了章和节，Section 创建必须成功
if (formData.chapter && formData.section) {
  // Section 创建失败会阻止提交
  const sectionRes = await sectionAPI.findOrCreate({...});
  // 如果失败，会显示错误并返回
}
```

---

## 📊 条件对比表

| 字段 | 进入第二步 | 保存草稿 | 提交审核 |
|------|-----------|---------|---------|
| **第一步字段** |
| 科目 | ✅ 必填 | - | - |
| 教材版本 | ✅ 必填 | - | - |
| 学段 | ✅ 必填 | - | - |
| 年级 | ✅ 必填 | - | - |
| 册别 | ✅ 必填 | - | - |
| 章 | ✅ 必填 | - | - |
| 节 | ✅ 必填 | - | - |
| **第二步字段** |
| 内容描述 | - | ✅ 必填 | ✅ 必填 |
| 知识类型 | - | ✅ 必填 | ✅ 必填 |
| 所属主题 | - | ⚠️ 可选 | ✅ 必填（至少1个） |
| 认知层级 | - | ⚠️ 可选 | ⚠️ 可选 |
| 难度等级 | - | ⚠️ 可选（默认1） | ⚠️ 可选（默认1） |
| 教学提示 | - | ⚠️ 可选 | ⚠️ 可选 |
| 章和节（Section） | - | ⚠️ 可选（失败不阻止） | ✅ 必填（如果填写了，必须成功） |

---

## 🎯 成功录入的完整流程

### 场景 1：保存草稿（最简单）

**最小必填项：**
1. ✅ 内容描述
2. ✅ 知识类型

**结果：** 知识点保存为 `DRAFT` 状态

---

### 场景 2：提交审核（完整流程）

**必填项：**
1. ✅ **第一步所有字段**（科目、版本、学段、年级、册别、章、节）
2. ✅ **内容描述**
3. ✅ **知识类型**
4. ✅ **至少一个主题**
5. ✅ **如果填写了章和节，Section 必须创建成功**

**结果：** 
- 知识点创建为 `DRAFT` 状态
- 自动提交审核，状态变为 `PENDING`
- 跳转到工作台页面

---

## ⚠️ 常见失败原因

### 保存草稿失败
1. ❌ 未填写内容描述
2. ❌ 未选择知识类型
3. ❌ 知识类型在后端不存在
4. ❌ 网络错误或后端服务异常

### 提交审核失败
1. ❌ 未填写内容描述
2. ❌ 未选择知识类型
3. ❌ 未选择任何主题
4. ❌ 选择的主题在后端不存在且无法创建
5. ❌ 填写了章和节，但 Section 创建失败
6. ❌ 用户未登录（需要认证）
7. ❌ 网络错误或后端服务异常

---

## 💡 最佳实践建议

### 推荐做法
1. **完整填写所有字段** - 确保信息完整，便于后续使用
2. **先保存草稿** - 填写过程中定期保存，避免数据丢失
3. **验证主题存在** - 提交前确保选择的主题在后端存在
4. **完整填写教材定位** - 确保章和节信息正确，便于知识点定位

### 注意事项
- 草稿可以不关联主题，但提交审核必须至少选择一个主题
- 章和节信息在保存草稿时失败不会阻止保存，但在提交审核时必须成功
- 所有必填字段都有红色星号（⭐）标记
- 难度等级默认为 1，但建议根据实际情况选择

---

## 🔍 后端验证规则

### 知识点创建 API (`POST /api/knowledge-points`)

**必填参数：**
- `content` - 知识点内容（字符串，不能为空）
- `typeId` - 知识类型ID（整数）

**可选参数：**
- `cognitiveLevelId` - 认知层级ID（整数，可选）
- `sectionId` - Section ID（整数，可选）
- `lessonId` - Lesson ID（整数，可选）
- `themeIds` - 主题ID数组（数组，可选）
- `versionTag` - 版本标签（字符串，可选）

**认证要求：**
- ✅ 必须登录（需要 JWT Token）

---

## 📝 总结

### 快速参考

**保存草稿：** 内容 + 类型 ✅

**提交审核：** 第一步全部 + 内容 + 类型 + 至少1个主题 + Section（如果填写了）✅

**进入第二步：** 第一步全部字段 ✅

